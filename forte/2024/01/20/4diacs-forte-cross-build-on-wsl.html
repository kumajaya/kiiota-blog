<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Build 4diac FORTE for Multiple Target on WSL | Kiiota Blog</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Build 4diac FORTE for Multiple Target on WSL" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Eclipse 4diac™ provides an open source infrastructure for distributed industrial process measurement and control systems based on the IEC 61499 standard. 4diac includes: development environment (4diac IDE), runtime environment (4diac FORTE), function block library, and example projects. The 4diac FORTE is a small portable implementation of an IEC 61499 runtime environment targeting small embedded control devices (16/32 Bit), implemented in C++. It supports online-reconfiguration of its applicat" />
<meta property="og:description" content="Eclipse 4diac™ provides an open source infrastructure for distributed industrial process measurement and control systems based on the IEC 61499 standard. 4diac includes: development environment (4diac IDE), runtime environment (4diac FORTE), function block library, and example projects. The 4diac FORTE is a small portable implementation of an IEC 61499 runtime environment targeting small embedded control devices (16/32 Bit), implemented in C++. It supports online-reconfiguration of its applicat" />
<link rel="canonical" href="https://kumajaya.github.io/kiiota-blog/forte/2024/01/20/4diacs-forte-cross-build-on-wsl.html" />
<meta property="og:url" content="https://kumajaya.github.io/kiiota-blog/forte/2024/01/20/4diacs-forte-cross-build-on-wsl.html" />
<meta property="og:site_name" content="Kiiota Blog" />
<meta property="og:image" content="https://images.unsplash.com/photo-1587919057555-d728ff5beac3?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wxMTc3M3wwfDF8c2VhcmNofDZ8fHJhc3BiZXJyeSUyMHBpfGVufDB8fHx8MTcwNTczMDQ2Mnww&ixlib=rb-4.0.3&q=80&w=2000" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-01-20T17:12:37+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://images.unsplash.com/photo-1587919057555-d728ff5beac3?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wxMTc3M3wwfDF8c2VhcmNofDZ8fHJhc3BiZXJyeSUyMHBpfGVufDB8fHx8MTcwNTczMDQ2Mnww&ixlib=rb-4.0.3&q=80&w=2000" />
<meta property="twitter:title" content="Build 4diac FORTE for Multiple Target on WSL" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-01-20T17:12:37+00:00","datePublished":"2024-01-20T17:12:37+00:00","description":"Eclipse 4diac™ provides an open source infrastructure for distributed industrial process measurement and control systems based on the IEC 61499 standard. 4diac includes: development environment (4diac IDE), runtime environment (4diac FORTE), function block library, and example projects. The 4diac FORTE is a small portable implementation of an IEC 61499 runtime environment targeting small embedded control devices (16/32 Bit), implemented in C++. It supports online-reconfiguration of its applicat","headline":"Build 4diac FORTE for Multiple Target on WSL","image":"https://images.unsplash.com/photo-1587919057555-d728ff5beac3?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wxMTc3M3wwfDF8c2VhcmNofDZ8fHJhc3BiZXJyeSUyMHBpfGVufDB8fHx8MTcwNTczMDQ2Mnww&ixlib=rb-4.0.3&q=80&w=2000","mainEntityOfPage":{"@type":"WebPage","@id":"https://kumajaya.github.io/kiiota-blog/forte/2024/01/20/4diacs-forte-cross-build-on-wsl.html"},"url":"https://kumajaya.github.io/kiiota-blog/forte/2024/01/20/4diacs-forte-cross-build-on-wsl.html"}</script>
<!-- End Jekyll SEO tag -->
<link id="main-stylesheet" rel="stylesheet" href="/kiiota-blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://kumajaya.github.io/kiiota-blog/feed.xml" title="Kiiota Blog" /><!-- Dark Mode Detection -->
<script>
  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.documentElement.classList.add('dark-mode');
  }
</script>

<!-- PrismJS Syntax Highlighting Theme + Plugins -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/themes/prism-coy.min.css" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/toolbar/prism-toolbar.min.css" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/line-numbers/prism-line-numbers.min.css" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/command-line/prism-command-line.min.css" crossorigin="anonymous">

<!-- KaTeX (Math Typesetting Engine) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css" crossorigin="anonymous">

<!-- Font Awesome Icon Suite -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- Dukungan favicon -->
<link rel="icon" type="image/png" sizes="16x16" href="/kiiota-blog/assets/media/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/kiiota-blog/assets/media/favicon-32x32.png">
<link rel="shortcut icon" href="/kiiota-blog/assets/media/favicon.ico">

<style>
/* Reduce site title line-height and bottom margin */
.site-header .wrapper {
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 60px;
  padding: 0 1rem;
}
.site-title {
  margin: 0;
  font-size: 1.5rem;
  line-height: 1.2;
  font-weight: bold;
  text-decoration: none;
  color: inherit;
}
.site-title:hover,
.site-title:focus {
  text-decoration: none;
  color: inherit;
}

/* Post header left-align */
.post-header {
  text-align: left !important;
  padding-left: 0;
  border-bottom: 1px solid var(--border-color, #e0e0e0);
}
.post-category a {
  text-decoration: none;
}
.post-category a:hover,
.post-category a:focus {
  text-decoration: none;
  color: inherit;
}
.post-title {
  text-align: left !important;
  margin-left: 0;
}

/* Hide Ghost-specific elements */
.kg-card, .kg-file-card, .kg-audio-card, .kg-audio-card *, .scroll-button, .scroll-button svg, .gh-sidebar {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* Native Audio Player Styling */
.native-audio-wrapper {
  margin: 1.5rem 0;
}

.native-audio-wrapper audio {
  width: 100%;
}

.audio-title {
  font-size: 1rem;
  font-weight: 600;
  color: #333;
  margin-bottom: 0.5rem;
  line-height: 1.4;
}

/* Mermaid Diagram Styling */
.mermaid {
  font-family: 'Segoe UI', sans-serif;
  background: rgba(255,255,255,0.9) !important;
  margin: 2.5rem auto;
  padding: 1.8rem;
  overflow: visible;
  text-align: center;
  opacity: 0;
  transition: opacity 0.5s ease-in;
}
.mermaid.is-ready { opacity: 1; }

/* Node & Label Styling */
.mermaid .node rect, .mermaid .node circle, .mermaid .node polygon, .mermaid .actor {
  fill: #ffffff;
  stroke: #3b82f6;
  stroke-width: 2.2px;
  rx: 8px; ry: 8px;
  filter: drop-shadow(0 2px 3px rgba(59,130,246,0.12)) drop-shadow(0 1px 1px rgba(59,130,246,0.1));
  transition: all 0.25s ease;
}
.mermaid .node text, .mermaid .label, .mermaid .label text {
  color: #1f2937;
  font-weight: 600;
  letter-spacing: 0.25px;
  line-height: 1.5;
}

/* Arrow & Edge Styling */
.mermaid .marker, .mermaid .arrowheadPath, .mermaid .arrowhead path { fill: #3b82f6 !important; stroke: none !important; }
.mermaid .edgePath path, .mermaid .path { stroke: #3b82f6; stroke-width: 2.6px; stroke-linecap: round; }
.mermaid path, .mermaid line { stroke-width: 1.5px !important; }

/* Diagram Title */
.mermaid .title, .mermaid .title text { font-weight: 600; color: #1e40af; }

/* Dark Mode Overrides */
.dark-mode .mermaid {
  background: rgba(17,24,39,0.85) !important;
  box-shadow: 0 4px 6px -1px rgba(0,0,0,0.2), 0 10px 15px -3px rgba(0,0,0,0.25);
}
.dark-mode .mermaid .node rect, .dark-mode .mermaid .node circle, .dark-mode .mermaid .node polygon, .dark-mode .mermaid .actor {
  fill: #111827;
  stroke: #60a5fa;
  filter: drop-shadow(0 2px 3px rgba(96,165,250,0.2)) drop-shadow(0 1px 1px rgba(96,165,250,0.15));
}
.dark-mode .mermaid .node text, .dark-mode .mermaid .label, .dark-mode .mermaid .label text { color: #f3f4f6; }
.dark-mode .mermaid .edgePath path, .dark-mode .mermaid .path { stroke: #60a5fa; }
.dark-mode .mermaid .title, .dark-mode .mermaid .title text { color: #93c5fd; }

/* Responsive Mermaid Adjustments */
@media (max-width: 768px) {
  .mermaid { padding: 1.2rem; border-radius: 10px; }
  .mermaid .label, .mermaid .node text, .mermaid .label text { font-size: 1.15rem !important; }
}

/* Table Styling */
table td, table th { border: 1px solid #e0e0e0; }
table tr:nth-child(even) { background-color: #f9f9f9; }
table td:first-child, table th:first-child { padding-left: 0.75em !important; }
table th { background-color: #222149; color: #fff !important; font-weight: bold; }
</style>
</head>
<body><header class="site-header">

  <div class="wrapper">
    <a class="site-title" rel="author" href="/kiiota-blog/">Kiiota Blog</a>
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon"></span>
        </label>

        <div class="nav-items">
  <a class="nav-item" href="/kiiota-blog/pages/contact.html">Kontak</a>
  <a class="nav-item" href="/kiiota-blog/pages/about.html">Tentang situs ini</a>
  <a class="nav-item" href="/kiiota-blog/pages/privacy.html">Privasi</a>
</div>

      </nav>
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
    

    
    <div class="post-category">
      
      <a href="/kiiota-blog/tags/4diac-forte">
        4diac Forte
      </a>
    </div>
    

    <h1 class="post-title p-name" itemprop="name headline">Build 4diac FORTE for Multiple Target on WSL</h1>
    <div class="post-meta">
      <time class="dt-published" datetime="2024-01-20T17:12:37+00:00" itemprop="datePublished">
        January 20, 2024
      </time>
      <div class="force-inline post-authors">
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Ketut Putu Kumajaya</span>
          </span>
        
      </div>
      
      <div class="force-inline post-authors">
        <span class="reading-time">16 min read</span>
      </div>
      
    </div>
  </header>

  
  <p class="post-excerpt" itemprop="description">
    Eclipse 4diac™ provides an open source infrastructure for distributed industrial process measurement and control systems based on the IEC 61499 standard. 4diac includes: development environment (4diac IDE), runtime environment (4diac FORTE), function block library, and example projects.

The 4diac FORTE is a small portable implementation of an IEC 61499 runtime environment targeting small embedded control devices (16/32 Bit), implemented in C++. It supports online-reconfiguration of its applicat

  </p>
  

  
  <figure class="post-feature-image">
    <img src="https://images.unsplash.com/photo-1587919057555-d728ff5beac3?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wxMTc3M3wwfDF8c2VhcmNofDZ8fHJhc3BiZXJyeSUyMHBpfGVufDB8fHx8MTcwNTczMDQ2Mnww&ixlib=rb-4.0.3&q=80&w=2000" alt="Build 4diac FORTE for Multiple Target on WSL" loading="lazy" class="post-feature-img">
    
    <figcaption class="post-feature-caption">
      <p>Photo by <a href="https://unsplash.com/@stefanbc?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit">Stefan Cosma</a> / <a href="https://unsplash.com/?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit">Unsplash</a></p>

    </figcaption>
    
  </figure>
  

  <div class="post-content e-content" itemprop="articleBody">
    
<h2></h2>
<p><strong><a href="https://eclipse.dev/4diac/index.php?ref=blog.kiiota.com">Eclipse 4diac™</a></strong> provides an open source infrastructure for distributed industrial process measurement and control systems based on the IEC 61499 standard. 4diac includes: development environment (<strong>4diac IDE</strong>), runtime environment (<strong>4diac FORTE</strong>), function block library, and example projects.</p>
<p><strong>The 4diac FORTE</strong> is a small portable implementation of an IEC 61499 runtime environment targeting small embedded control devices (16/32 Bit), implemented in C++. It supports online-reconfiguration of its applications and the real-time capable execution of all function block types provided by the IEC 61499 standard.</p>
<p><em>Supported communication layers</em>: Ethernet (TCP/UDP), Ethernet PowerLink using <a href="http://sourceforge.net/projects/openpowerlink/?ref=blog.kiiota.com">openPOWERLINK V1.8.0</a>, FBDK ASN.1 encoding, Modbus TCP client using <a href="http://libmodbus.org/?ref=blog.kiiota.com">libmodbus</a>, MQTT using <a href="http://www.eclipse.org/paho/?ref=blog.kiiota.com">Eclipse Paho</a>, OPC UA using <a href="https://github.com/open62541/open62541?ref=blog.kiiota.com">open62541</a>, OPC DA client using <a href="http://sourceforge.net/projects/opcclient/?ref=blog.kiiota.com">OPC Client library release 0.4</a>, RS232.</p>
<p><em>Supported operating system</em>: <a href="http://ecos.sourceware.org/?ref=blog.kiiota.com">eCos</a>, <a href="http://www.digi.com/products/wireless-wired-embedded-solutions/software-microprocessors-accessories/software/netos?ref=blog.kiiota.com">NET+OS 7</a>, Posix: <a href="https://www.cygwin.com/?ref=blog.kiiota.com">Cygwin</a>, Linux (i386, PPC, ARM), <a href="https://kb.hilscher.com/display/RCX/rcX?ref=blog.kiiota.com">rcX</a>, <a href="http://www.windriver.com/products/vxworks/?ref=blog.kiiota.com">VxWorks</a>, <a href="https://www.sysgo.com/products/pikeos-hypervisor/?ref=blog.kiiota.com">PikeOS</a>, Windows, <a href="http://www.freertos.org/?ref=blog.kiiota.com">freeRTOS</a>.</p>
<p><em>Supported board</em>: <a href="http://beagleboard.org/black?ref=blog.kiiota.com">BeagleBone Black</a>, <a href="http://www.digi.com/products/embedded-systems?ref=blog.kiiota.com">Digi Connect ME</a> (ARM7), <a href="http://www.embrick.de/?ref=blog.kiiota.com">emBRICK</a> for Raspberry PI and BeagleBone Black, <a href="http://www.kipr.org/products/cbc-robot-controller?ref=blog.kiiota.com">KIPR's CBC v2</a> robot controller, <a href="http://mindstorms.lego.com/en-us/Default.aspx?ref=blog.kiiota.com">Lego Mindstorms EV3</a> (ARM7), <a href="http://www.hilscher.com/?ref=blog.kiiota.com">NXH 51-ETM</a>, <a href="http://www.raspberrypi.org/?ref=blog.kiiota.com">Raspberry PI</a>.</p>
<p><em>Supported Programmable Logic Controllers (PLCs)</em>: <a href="http://www.bachmann.info/en/products/controller-system/?ref=blog.kiiota.com">Bachmann electronic M1 PLC</a>, <a href="http://raspberry-sps.de/?ref=blog.kiiota.com">Raspberry-SPS</a>, <a href="http://global.wago.com/en/products/new-items/overview/pfc200-1.jsp?ref=blog.kiiota.com">WAGO PFC200</a>, <a href="http://www.microcontrol.net/en/products/control-systems/umic200/?ref=blog.kiiota.com">MicroControl uMIC.200</a>, <a href="https://www.insys-icom.de/icom-smartbox/container?ref=blog.kiiota.com">icom MR-router series</a>.</p>
<p><strong>Linux </strong>is a perfect environment for compiling programs for different machine targets and WSL is an easy way to set up a Linux environment on a Windows desktop. Another alternative is <a href="https://www.msys2.org/?ref=blog.kiiota.com">MSYS </a>but it is limited to Windows targets and compilation is noticeably slow.</p>
<p><strong>Windows Subsystem for Linux</strong> (<strong>WSL</strong>) is a feature of Windows that allows developers to run a Linux environment without the need for a separate <a href="https://en.wikipedia.org/wiki/Virtual_machine?ref=blog.kiiota.com">virtual machine</a> or <a href="https://en.wikipedia.org/wiki/Dual_booting?ref=blog.kiiota.com">dual booting</a>.</p>
<p>Installing WSL is outside the scope here, please read the document from Microsoft regarding how to <a href="https://learn.microsoft.com/en-us/windows/wsl/install?ref=blog.kiiota.com">install WSL with the default Ubuntu Linux distribution</a>. Let's start cross compiling FORTE on WSL for the Raspberry Pi 4B and/or Windows target.</p>
<p><strong>Update:</strong></p>
<blockquote>A bash script for all of these tasks are included at the end of this post!</blockquote>
<p><strong>Install the additional software needed on WSL</strong></p>
<p><em><strong>For Raspberry Pi 4B target</strong></em>:</p>
<pre><code class="language-javascript">$ sudo apt-get install gcc-aarch64-linux-gnu g++-aarch64-linux-gnu git make cmake automake autoconf libtool cmake-gui
$ mkdir $HOME/forte</code></pre>
<p>For Windows target, the g++-mingw-w64 package built into Ubuntu 22.04 doesn't seem to work properly so we need a newer version of the package from another source, extract it in your $HOME directory:</p>
<pre><code class="language-javascript">$ cd
$ sudo apt-get install gcc-mingw-w64 g++-mingw-w64
$ wget -c https://github.com/xpack-dev-tools/mingw-w64-gcc-xpack/releases/download/v13.2.0-1/xpack-mingw-w64-gcc-13.2.0-1-linux-x64.tar.gz
$ tar xvf xpack-mingw-w64-gcc-13.2.0-1-linux-x64.tar.gz
$ export PATH=$HOME/xpack-mingw-w64-gcc-13.2.0-1/bin:$PATH</code></pre>
<p><strong>Update</strong>:</p>
<blockquote>I decided to upgrade Ubuntu WSL from 22.04 LTS "Jammy Jellyfish" to 24.04 LTS "Noble Numbat" to use gcc-mingw-w64 and g++-mingw-w64 packages from Ubuntu distribution but had a problem with FORTE that compilation result did not run without any error message. In order for FORTE compilation results run successfully we have to change gcc and g++ thread model from default win32 to posix, do the following:</blockquote>
<pre><code class="language-javascript">$ sudo do-release-upgrade -d # upgrade Ubuntu to 24.04
$ sudo update-alternatives --list x86_64-w64-mingw32-gcc
/usr/bin/x86_64-w64-mingw32-gcc-posix
/usr/bin/x86_64-w64-mingw32-gcc-win32
$ sudo update-alternatives --set x86_64-w64-mingw32-gcc /usr/bin/x86_64-w64-mingw32-gcc-posix
$ sudo update-alternatives --list x86_64-w64-mingw32-g++
/usr/bin/x86_64-w64-mingw32-g++-posix
/usr/bin/x86_64-w64-mingw32-g++-win32
$ sudo update-alternatives --set x86_64-w64-mingw32-g++ /usr/bin/x86_64-w64-mingw32-g++-posix</code></pre>
<p><strong>Update:</strong></p>
<blockquote>Upgrade to Ubuntu 24.04 make me feel stupid because the compilation result for Raspberry doesn't work anymore with an error message "/lib/aarch64-linux-gnu/libc.so.6: version `GLIBC_2.38' not found" even though I compiled using gcc version 11. Incompatible libc version!</blockquote>
<pre><code class="language-javascript">$ ldd --version
ldd (Ubuntu GLIBC 2.35-0ubuntu3.6) 2.35
Copyright (C) 2022 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
Written by Roland McGrath and Ulrich Drepper.</code></pre>
<blockquote>I suggest sticking with Ubuntu version 22.04 or switch to GNU toolchain from <a href="https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads?ref=blog.kiiota.com">Arm </a>but then requires an adjustments in compilation: change compiler from aarch64-linux-gnu-* to aarch64-none-linux-gnu-*</blockquote>
<pre><code class="language-javascript">$ cd
$ wget -c https://armkeil.blob.core.windows.net/developer/Files/downloads/gnu/11.3.rel1/binrel/arm-gnu-toolchain-11.3.rel1-x86_64-aarch64-none-linux-gnu.tar.xz
$ tar xvf arm-gnu-toolchain-11.3.rel1-x86_64-aarch64-none-linux-gnu.tar.xz
$ export PATH=$HOME/arm-gnu-toolchain-11.3.rel1-x86_64-aarch64-none-linux-gnu/bin:$PATH</code></pre>
<p><strong>Download and build libmodbus static library</strong></p>
<pre><code class="language-javascript">$ cd ~/forte
$ git clone https://github.com/stephane/libmodbus.git --depth=1
$ cd libmodbus</code></pre>
<p><em><strong>For Raspberry target</strong></em>:</p>
<pre><code class="language-javascript">$ ./autogen.sh
$ ./configure --with-pic --enable-static --enable-shared=no --host=aarch64-linux-gnu --prefix=$HOME/forte/install/aarch64
$ make -j3
$ make install
$ make clean</code></pre>
<p><em><strong>For Windows target</strong></em>:</p>
<pre><code class="language-javascript">$ ./autogen.sh
$ ./configure --with-pic --enable-static --enable-shared=no --host=x86_64-w64-mingw32 --prefix=$HOME/forte/install/x86_w64
$ make -j3
$ make install
$ make clean</code></pre>
<p><strong>Download and build LuaJIT shared library with Lua 5.2 compatibility enabled</strong></p>
<pre><code class="language-javascript">$ cd ~/forte
$ git clone https://github.com/LuaJIT/LuaJIT.git --depth=1
$ cd LuaJIT</code></pre>
<p><strong><em>For Raspberry target</em></strong>:</p>
<pre><code class="language-javascript">$ make -j3 CROSS=aarch64-linux-gnu- CFLAGS=-DLUAJIT_ENABLE_LUA52COMPAT
$ make install CROSS=aarch64-linux-gnu- CFLAGS=-DLUAJIT_ENABLE_LUA52COMPAT PREFIX=$HOME/forte/install/aarch64
$ make clean</code></pre>
<p><strong><em>For Windows target</em></strong>:</p>
<pre><code class="language-javascript">$ make -j3 CROSS=x86_64-w64-mingw32- CFLAGS=-DLUAJIT_ENABLE_LUA52COMPAT TARGET_SYS=Windows
$ mv src/luajit.exe src/luajit # a trick to prevent `make install` failure
$ cp src/lua51.dll ~/forte/install/x86_w64/lib/ # manual copy lua shared library
$ make install CROSS=x86_64-w64-mingw32- CFLAGS=-DLUAJIT_ENABLE_LUA52COMPAT TARGET_SYS=Windows PREFIX=$HOME/forte/install/x86_w64
$ make clean</code></pre>
<p><strong>Download and build OpenSSL</strong></p>
<pre><code class="language-javascript">$ cd ~/forte
$ git clone https://github.com/openssl/openssl.git --depth=1
$ cd openssl</code></pre>
<p><strong><em>Build OpenSSL shared library for Raspberry target</em></strong>:</p>
<pre><code class="language-javascript">$ ./Configure linux-aarch64 shared --cross-compile-prefix=aarch64-linux-gnu- --prefix=$HOME/forte/install/aarch64
$ make -j3
$ make install
$ make clean</code></pre>
<p><strong><em>Build OpenSSL static library for Windows target</em></strong>:</p>
<pre><code class="language-javascript">$ ./Configure mingw64 no-shared -static --cross-compile-prefix=x86_64-w64-mingw32- --prefix=$HOME/forte/install/x86_w64
$ make -j3
$ make install
$ cp $HOME/forte/install/x86_w64/lib64/libcrypto.a $HOME/forte/install/x86_w64/lib/ # create a duplicate copy to lib
$ cp $HOME/forte/install/x86_w64/lib64/libssl.a $HOME/forte/install/x86_w64/lib/ # create a duplicate copy to lib
$ make clean</code></pre>
<p><strong>Download and build Paho MQTT static library</strong></p>
<pre><code class="language-javascript">$ cd ~/forte
$ git clone https://github.com/eclipse/paho.mqtt.c.git --depth=1</code></pre>
<p><em><strong>For Raspberry target</strong></em>:</p>
<pre><code class="language-javascript">$ cd ~/forte
$ mkdir -p build/paho/aarch64
$ which aarch64-linux-gnu-gcc # check where gcc location
/usr/bin/aarch64-linux-gnu-gcc
$ which aarch64-linux-gnu-++ # check where g++ location
/usr/bin/aarch64-linux-gnu-g++</code></pre>
<p>Run CMake from inside Ubuntu sub menu on Windows start menu and set:</p>
<pre><code>Source code: /home/user/forte/paho.mqtt.c
Build binaries: /home/user/forte/build/paho/aarch64</code></pre>
<p>Run Configure and select Unix Makefiles for cross compiling and set:</p>
<pre><code>C compiler: /usr/bin/aarch64-linux-gnu-gcc
C++ compiler: /usr/bin/aarch64-linux-gnu-g++</code></pre>
<p>Click Finish and set the setup as follows, it may be necessary to generate repeatedly to fulfill all the setups without errors.</p>
<pre><code class="language-javascript">CMAKE_BUILD_TYPE=Release
CMAKE_INSTALL_PREFIX=/home/user/forte/install/aarch64
PAHO_BUILD_SHARED=OFF
PAHO_BUILD_STATIC=ON
PAHO_ENABLE_TESTING=OFF
PAHO_WITH_SSL=ON
OPENSSL_INCLUDE_DIR=/home/user/forte/install/aarch64/include
OPENSSL_ROOT_DIR=/home/user/forte/install/aarch64
OPENSSL_CRYPTO_LIBRARY=/home/user/forte/install/aarch64/lib/libcrypto.so
OPENSSL_SSL_LIBRARY=/home/user/forte/install/aarch64/lib/libssl.so</code></pre>
<p>Compile and install Paho MQTT:</p>
<pre><code class="language-javascript">make -j3
make install
make clean</code></pre>
<p><em><strong>For Windows target</strong></em>:</p>
<pre><code class="language-javascript">$ cd ~/forte
$ mkdir -p build/paho/x86_w64
$ which x86_64-w64-mingw32-gcc # check where gcc location
/home/user/xpack-mingw-w64-gcc-13.2.0-1/bin/x86_64-w64-mingw32-gcc
$ which x86_64-w64-mingw32-g++ # check where g++ location
/home/user/xpack-mingw-w64-gcc-13.2.0-1/bin/x86_64-w64-mingw32-g++</code></pre>
<p>Run CMake from inside Ubuntu sub menu on Windows start menu and set:</p>
<pre><code>Source code: /home/user/forte/paho.mqtt.c
Build binaries: /home/user/forte/build/paho/x86_w64</code></pre>
<p>Run Configure and select Unix Makefiles for cross compiling and set:</p>
<pre><code>C compiler: /home/user/xpack-mingw-w64-gcc-13.2.0-1/bin/x86_64-w64-mingw32-gcc
C++ compiler: /home/user/xpack-mingw-w64-gcc-13.2.0-1/bin/x86_64-w64-mingw32-g++</code></pre>
<p>Click Finish and set the setup as follows, it may be necessary to generate repeatedly to fulfill all the setups without errors.</p>
<pre><code class="language-javascript">MINGW=ON # Manually added bool entry to tell CMake we are in a MINGW environment
CMAKE_BUILD_TYPE=Release
CMAKE_INSTALL_PREFIX=/home/user/forte/install/x86_w64
PAHO_BUILD_SHARED=OFF
PAHO_BUILD_STATIC=ON
PAHO_ENABLE_TESTING=OFF
PAHO_WITH_SSL=ON
OPENSSL_INCLUDE_DIR=/home/user/forte/install/x86_w64/include
OPENSSL_ROOT_DIR=/home/user/forte/install/x86_w64
OPENSSL_CRYPTO_LIBRARY=/home/user/forte/install/x86_w64/lib/libcrypto.a
OPENSSL_SSL_LIBRARY=/home/user/forte/install/x86_w64/lib/libssl.a</code></pre>
<p>Follow Raspberry step to compile and install Paho MQTT.</p>
<p><strong>Download and build open62541 OPC UA static library</strong></p>
<pre><code class="language-javascript">$ cd ~/forte
$ git clone https://github.com/open62541/open62541.git -b pack/v1.3.9 --depth=1
$ cd open62541
$ git submodule update --init --recursive --depth 1</code></pre>
<p><strong><em>For Raspberry target:</em></strong></p>
<p>Run CMake and set:</p>
<pre><code>Source code: /home/user/forte/open62541
Build binaries: /home/user/forte/build/open62541/aarch64</code></pre>
<p>Follow previous CMake configuration step and set:</p>
<pre><code class="language-javascript">CMAKE_BUILD_TYPE=Release
CMAKE_INSTALL_PREFIX=/home/user/forte/install/aarch64
UA_ARCHITECTURE=posix
UA_ENABLE_AMALGAMATION=ON
CMAKE_INSTALL_PREFIX=/home/user/forte/install/aarch64
UA_ENABLE_DISCOVERY=ON
UA_ENABLE_DISCOVERY_MULTICAST=ON
UA_ENABLE_ENCRYPTION=OPENSSL
OPENSSL_INCLUDE_DIR=/home/user/forte/install/aarch64/include
OPENSSL_CRYPTO_LIBRARY=/home/user/forte/install/aarch64/lib/libcrypto.so
OPENSSL_SSL_LIBRARY=/home/user/forte/install/aarch64/lib/libssl.so</code></pre>
<p>Follow previous step to compile and install open62541.</p>
<p><strong><em>For Windows target:</em></strong></p>
<p>Run CMake and set:</p>
<pre><code>Source code: /home/user/forte/open62541
Build binaries: /home/user/forte/build/open62541/x86_w64</code></pre>
<p>Follow previous CMake configuration step and set:</p>
<pre><code class="language-javascript">MINGW=ON # Manually added bool entry to tell CMake we are in a MINGW environment
CMAKE_BUILD_TYPE=Release
CMAKE_INSTALL_PREFIX=/home/user/forte/install/x86_w64
UA_ARCHITECTURE=win32
UA_ENABLE_AMALGAMATION=ON
CMAKE_INSTALL_PREFIX=/home/user/forte/install/x86_w64
UA_ENABLE_DISCOVERY=ON
UA_ENABLE_DISCOVERY_MULTICAST=ON
UA_ENABLE_ENCRYPTION=OPENSSL
OPENSSL_INCLUDE_DIR=/home/user/forte/install/x86_w64/include
OPENSSL_CRYPTO_LIBRARY=/home/user/forte/install/x86_w64/lib/libcrypto.a
OPENSSL_SSL_LIBRARY=/home/user/forte/install/x86_w64/lib/libssl.a</code></pre>
<p>Follow previous step to compile and install open62541.</p>
<p><strong>Download and build 4diac's FORTE development branch:</strong></p>
<p>We will compile a development version of FORTE and therefore require a milestone version of the IDE which can be downloaded from <a href="https://download.eclipse.org/4diac/updates/milestone/?ref=blog.kiiota.com">4diac's milestone software repository</a>.</p>
<pre><code class="language-javascript">$ cd ~/forte
$ git clone https://git.eclipse.org/r/4diac/org.eclipse.4diac.forte.git -b develop --depth=100
$ cd org.eclipse.4diac.forte
$ git checkout -b local # a local branch to fix a compilation error
$ sed -i '39s/include )/include\/modbus )/' src/com/modbus/CMakeLists.txt
$ sed -i '41s/libmodbus.lib ) /modbus )/' src/com/modbus/CMakeLists.txt</code></pre>
<p><strong><em>For Raspberry target:</em></strong></p>
<p>Run CMake and set:</p>
<pre><code>Source code: /home/user/forte/org.eclipse.4diac.forte
Build binaries: /home/user/forte/build/forte/aarch64</code></pre>
<p>Follow previous CMake configuration step and set:</p>
<pre><code class="language-javascript">CMAKE_BUILD_TYPE=Release
CMAKE_INSTALL_PREFIX=/home/user/forte/install/aarch64
FORTE_ARCHITECTURE=posix
FORTE_COM_HTTP=ON
FORTE_COM_MODBUS=ON
FORTE_COM_OPC_UA=ON
FORTE_COM_PAHOMQTT=ON
FORTE_EXTERNAL_MODULES_DIRECTORY=/home/user/forte/ext_modules
FORTE_MODULE_CONVERT=ON
FORTE_MODULE_IEC61131=ON
FORTE_MODULE_RECONFIGURATION=ON
FORTE_MODULE_RT_Events=ON
FORTE_MODULE_UTILS=ON
FORTE_MODULE_SysFs=ON
FORTE_USE_LUATYPES=LuaJIT
FORTE_COM_MODBUS_LIB_DIR=/home/user/forte/install/aarch64
FORTE_COM_OPC_UA_ENCRYPTION=ON
FORTE_COM_OPC_UA_INCLUDE_DIR=/home/user/forte/install/aarch64/include
FORTE_COM_OPC_UA_LIB=libopen62541.a
FORTE_COM_OPC_UA_LIB_DIR=/home/user/forte/install/aarch64/lib
FORTE_COM_OPC_UA_MULTICAST=ON
FORTE_COM_PAHOMQTT_INCLUDE_DIR=/home/user/forte/install/aarch64/include
FORTE_COM_PAHOMQTT_LIB=libpaho-mqtt3as.a # MQTT asynchronous with SSL support
FORTE_COM_PAHOMQTT_LIB_DIR=/home/user/forte/install/aarch64/lib
FORTE_COM_SER=ON
LUAJIT_INCLUDE_DIR=/home/user/forte/install/aarch64/include/luajit-2.1
LUAJIT_LIBRARY=/home/user/forte/install/aarch64/lib/libluajit-5.1.so
FORTE_COM_OPC_UA_ENCRYPTION_MBEDTLS=OFF
FORTE_COM_OPC_UA_ENCRYPTION_INCLUDE_DIR=/home/user/forte/install/aarch64/include
FORTE_COM_OPC_UA_ENCRYPTION_LIB_DIR=/home/user/forte/install/aarch64/lib</code></pre>
<p>Compile and install FORTE:</p>
<pre><code class="language-javascript">$ make -j3
$ make install
$ cd ~/forte/install/aarch64/
$ cp lib/libcrypto.so.3 lib/libssl.so.3 bin/
$ cp lib/libluajit-5.1.so.2.1.1703358377 bin/libluajit-5.1.so.2
$ aarch64-linux-gnu-strip bin/* # remove symbols and debugging information for a smaller binary size</code></pre>
<figure class="kg-card kg-image-card kg-card-hascaption"><img src="/kiiota-blog/assets/media/00ccff95-eca3-4ac2-bafa-577ab15704af-forte-rasp.png" class="kg-image" alt="" loading="lazy" width="1115" height="628" /><figcaption>FORTE on Raspberry Pi 4B over SSH Access</figcaption></figure>
<p><strong><em>For Windows target:</em></strong></p>
<p>Run CMake and set:</p>
<pre><code>Source code: /home/user/forte/org.eclipse.4diac.forte
Build binaries: /home/user/forte/build/forte/x86_w64</code></pre>
<p>Follow previous CMake configuration step and set:</p>
<pre><code class="language-javascript">MINGW=ON # Manually added bool entry to tell CMake we are in a MINGW environment
CMAKE_C_STANDARD_LIBRARIES=-lws2_32 -lcrypt32 # Manually added for libmodbus and openssl
CMAKE_CXX_STANDARD_LIBRARIES=-lws2_32 -lcrypt32 # Manually added for libmodbus and openssl
CMAKE_BUILD_TYPE=Release
CMAKE_INSTALL_PREFIX=/home/user/forte/install/x86_w64
FORTE_ARCHITECTURE=win32
FORTE_COM_HTTP=ON
FORTE_COM_MODBUS=ON
FORTE_COM_OPC_UA=ON
FORTE_COM_PAHOMQTT=ON
FORTE_EXTERNAL_MODULES_DIRECTORY=/home/user/forte/ext_modules
FORTE_MODULE_CONVERT=ON
FORTE_MODULE_IEC61131=ON
FORTE_MODULE_RECONFIGURATION=ON
FORTE_MODULE_RT_Events=ON
FORTE_MODULE_UTILS=ON
FORTE_USE_LUATYPES=LuaJIT
FORTE_COM_MODBUS_LIB_DIR=/home/user/forte/install/x86_w64
FORTE_COM_OPC_UA_ENCRYPTION=ON
FORTE_COM_OPC_UA_INCLUDE_DIR=/home/user/forte/install/x86_w64/include
FORTE_COM_OPC_UA_LIB=libopen62541.a
FORTE_COM_OPC_UA_LIB_DIR=/home/user/forte/install/x86_w64/lib
FORTE_COM_OPC_UA_MULTICAST=ON
FORTE_COM_PAHOMQTT_INCLUDE_DIR=/home/user/forte/install/x86_w64/include
FORTE_COM_PAHOMQTT_LIB=libpaho-mqtt3as.a # MQTT asynchronous with SSL support
FORTE_COM_PAHOMQTT_LIB_DIR=/home/user/forte/install/x86_w64/lib
FORTE_COM_SER=ON
LUAJIT_INCLUDE_DIR=/home/user/forte/install/x86_w64/include/luajit-2.1
LUAJIT_LIBRARY=/home/user/forte/install/x86_w64/lib/lua51.dll
FORTE_COM_OPC_UA_ENCRYPTION_MBEDTLS=OFF
FORTE_COM_OPC_UA_ENCRYPTION_INCLUDE_DIR=/home/user/forte/install/aarch64/include
FORTE_COM_OPC_UA_ENCRYPTION_LIB_DIR=/home/user/forte/install/x86_w64/lib</code></pre>
<p>Compile and install FORTE:</p>
<pre><code class="language-javascript">$ make -j3
$ cp src/forte.exe $HOME/forte/install/x86_w64/bin
$ $HOME/forte/install/x86_w64/lib/lua51.dll $HOME/forte/install/x86_w64/bin
$ x86_64-w64-mingw32-strip ~/forte/install/x86_w64/bin/*</code></pre>
<p>Ubuntu WSL mount WSL drive on Explorer with the famous Tux the Penguin icon. For Windows target, we can run FORTE directly from WSL drive with a double click.</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><img src="/kiiota-blog/assets/media/00ccff95-eca3-4ac2-bafa-577ab15704af-forte.png" class="kg-image" alt="" loading="lazy" width="1115" height="628" /><figcaption>FORTE Windows Native outside WSL</figcaption></figure>
<figure class="kg-card kg-image-card kg-card-hascaption"><img src="/kiiota-blog/assets/media/00ccff95-eca3-4ac2-bafa-577ab15704af-forte-lin.png" class="kg-image" alt="" loading="lazy" width="1115" height="628" /><figcaption>FORTE Linux Native inside WSL</figcaption></figure>
<p>To make it easier, here is a long and dumb bash script to build 4diac's FORTE and all it's dependencies in single shot!</p>
<p><strong>Update:</strong></p>
<blockquote>I found OpenSSL not working properly yet with Open62541 OPC UA library version 1.3.9 and updated below script use Mbed-TLS as encryption support to FORTE OPC UA client. I attach some patches for FORTE to <a href="https://www.eclipse.org/forums/index.php/t/1114282/?ref=blog.kiiota.com">4diac</a> forum, please check it.</blockquote>
<pre><code class="language-javascript">#!/bin/bash
echo "----------------------------------------------------------------------------"
echo " Build FORTE for Raspberry Pi aarch64, Windows x86_w64, or Linux x86_64"
echo "----------------------------------------------------------------------------"
echo ""
echo " Includes Modbus, OPC UA, MQTT, OpenSSL, and LuaJIT support"
echo ""
echo "----------------------------------------------------------------------------"

install_if_not_exist() {
  if dpkg -s "$1" &amp;&gt;/dev/null; then
    PKG_EXIST=$(dpkg -s "$1" | grep "install ok installed")
    if [[ -n "$PKG_EXIST" ]]; then
      return
    fi
  fi
  sudo apt install "$1" -y
}

#run this before execute this script
#sudo apt update -y

if [ $# -eq 0 ]; then
  arch="aarch64"
else
  arch=$1
fi

mkdir -p $HOME/toolchain/

if [ "$arch" == "x86_64" ]; then
  forte_arch="x86_64"
  forte_toolchain_dir=""
  #comment out to install gcc and g++ compiler
  #install_if_not_exist gcc-x86-64-linux-gnu
  #install_if_not_exist g++-x86-64-linux-gnu
  forte_compiler_prefix="x86_64-linux-gnu-"
  forte_cmake_ua_arch="posix"
  forte_cmake_arch="Posix"
  forte_cmake_luajit_lib="libluajit-5.1.so"
elif [ "$arch" == "x86_w64" ]; then
  forte_arch="x86_w64"
  forte_toolchain_dir="$HOME/toolchain/xpack-mingw-w64-gcc-13.2.0-1"
  # [ ! -d "$forte_toolchain_dir" ] &amp;&amp; wget -c https://github.com/xpack-dev-tools/mingw-w64-gcc-xpack/releases/download/v13.2.0-1/xpack-mingw-w64-gcc-13.2.0-1-linux-x64.tar.gz -O $HOME/toolchain/xpack-mingw-w64-gcc-13.2.0-1-linux-x64.tar.gz
  # [ ! -d "$forte_toolchain_dir" ] &amp;&amp; tar xvf $HOME/toolchain/xpack-mingw-w64-gcc-13.2.0-1-linux-x64.tar.gz -C $HOME/toolchain/
  forte_compiler_prefix="x86_64-w64-mingw32-"
  forte_cmake_ua_arch="win32"
  forte_cmake_arch="Win32"
  forte_cmake_extra="-DMINGW:BOOL=ON"
  forte_luajit_config="TARGET_SYS=Windows"
  forte_cmake_luajit_lib="lua51.dll"
  forte_cmake_libs="-lws2_32 -lcrypt32 -lbcrypt"
elif [ "$arch" == "aarch64" ]; then
  forte_arch="aarch64"
  forte_toolchain_dir="$HOME/toolchain/arm-gnu-toolchain-12.3.rel1-x86_64-aarch64-none-linux-gnu"
  # [ ! -d "$forte_toolchain_dir" ] &amp;&amp; wget -c https://armkeil.blob.core.windows.net/developer/Files/downloads/gnu/12.3.rel1/binrel/arm-gnu-toolchain-12.3.rel1-x86_64-aarch64-none-linux-gnu.tar.xz -O $HOME/toolchain/arm-gnu-toolchain-12.3.rel1-x86_64-aarch64-none-linux-gnu.tar.xz
  # [ ! -d "$forte_toolchain_dir" ] &amp;&amp; tar xvf $HOME/toolchain/arm-gnu-toolchain-12.3.rel1-x86_64-aarch64-none-linux-gnu.tar.xz -C $HOME/toolchain/
  forte_compiler_prefix="aarch64-none-linux-gnu-"
  forte_cmake_ua_arch="posix"
  forte_cmake_arch="Posix"
  forte_cmake_luajit_lib="libluajit-5.1.so"
  #extra module for Raspberry
  forte_cmake_extra="-DFORTE_MODULE_SysFs=ON"
elif [ "$arch" == "aarch64-musl" ]; then
  forte_arch="aarch64-musl"
  forte_toolchain_dir="$HOME/toolchain/aarch64--musl--stable-2023.11-1"
  # [ ! -d "$forte_toolchain_dir" ] &amp;&amp; wget -c https://toolchains.bootlin.com/downloads/releases/toolchains/aarch64/tarballs/aarch64--musl--stable-2023.11-1.tar.bz2
  # [ ! -d "$forte_toolchain_dir" ] &amp;&amp; tar xvf aarch64--musl--stable-2023.11-1.tar.bz2 -C $HOME/toolchain/
  #disable musl toolchain python version to prevent mbedtls build failed
  [ -L "$forte_toolchain_dir/bin/python" ] &amp;&amp; mv $forte_toolchain_dir/bin/python $forte_toolchain_dir/bin/python.bak
  [ -L "$forte_toolchain_dir/bin/python3" ] &amp;&amp; mv $forte_toolchain_dir/bin/python3 $forte_toolchain_dir/bin/python3.bak
  [ -f "$forte_toolchain_dir/bin/python3.11" ] &amp;&amp; mv $forte_toolchain_dir/bin/python3.11 $forte_toolchain_dir/bin/python3.11.bak
  [ -L "$forte_toolchain_dir/bin/python-config" ] &amp;&amp; mv $forte_toolchain_dir/bin/python-config $forte_toolchain_dir/bin/python-config.bak
  [ -L "$forte_toolchain_dir/bin/python3-config" ] &amp;&amp; mv $forte_toolchain_dir/bin/python3-config $forte_toolchain_dir/bin/python3-config.bak
  [ -f "$forte_toolchain_dir/bin/python3.11-config" ] &amp;&amp; mv $forte_toolchain_dir/bin/python3.11-config $forte_toolchain_dir/bin/python3.11-config.bak
  forte_compiler_prefix="aarch64-linux-"
  forte_cmake_ua_arch="posix"
  forte_cmake_arch="Posix"
  forte_cmake_luajit_lib="libluajit-5.1.a"
  forte_cmake_extra="-DFORTE_MODULE_SysFs=ON -DMUSL:BOOL=ON"
else
  echo "!!!! Invalid argument! Please check https://blog.kiiota.com/4diacs-forte-cross-build-on-wsl/ "
  exit
fi
export PATH=$forte_toolchain_dir/bin:$PATH

forte_root_dir="$PWD"
forte_sources_dir="$forte_root_dir/sources"
forte_build_dir="$forte_root_dir/build/$forte_arch"
forte_install_dir="$forte_root_dir/install/$forte_arch"

[ ! -d "$forte_sources_dir" ] &amp;&amp; mkdir -p "$forte_sources_dir"
[ ! -d "$forte_build_dir" ] &amp;&amp; mkdir -p "$forte_build_dir"
[ ! -d "$forte_install_dir" ] &amp;&amp; mkdir -p "$forte_install_dir"

echo "==== Install package dependencies..."
install_if_not_exist git
install_if_not_exist make
install_if_not_exist cmake
#automake, autoconf, libtool for libmodbus
install_if_not_exist automake
install_if_not_exist autoconf
install_if_not_exist libtool
#python3-jsonschema for mbedtls
install_if_not_exist python3-jsonschema
echo "==== Dependecies install completed"

echo "==== Download dependencies and FORTE source codes..."
cd $forte_sources_dir
if [ ! -d "libmodbus" ]; then
  echo "---- Download libmodbus source..."
  git clone https://github.com/stephane/libmodbus.git --depth=1
fi

if [ ! -d "LuaJIT" ]; then
  echo "---- Download LuaJIT source..."
  git clone https://github.com/LuaJIT/LuaJIT.git --depth=1
fi

if [ ! -d "mbedtls" ]; then
  echo "---- Download mbedtls source..."
  git clone https://github.com/Mbed-TLS/mbedtls.git --depth=1
fi

if [ ! -d "paho.mqtt.c" ]; then
  echo "---- Download paho.mqtt.c source..."
  git clone https://github.com/eclipse/paho.mqtt.c.git --depth=1
fi

if [ ! -d "open62541" ]; then
  echo "---- Download open62541 source..."
  git clone https://github.com/open62541/open62541.git -b pack/v1.3.9 --depth=1
  cd open62541
  git submodule update --init --recursive --depth 1
  cd ../
fi

if [ ! -d "org.eclipse.4diac.forte" ]; then
  echo "---- Download org.eclipse.4diac.forte source..."
  git clone https://git.eclipse.org/r/4diac/org.eclipse.4diac.forte.git -b develop --depth=1
fi
echo "==== Download source codes completed"

echo "==== Build FORTE for $forte_arch target begin..."
echo "==== Build dependencies from sources..."
cd $forte_sources_dir
#build libmodbus if static library not exists
if [ -d "libmodbus" ] &amp;&amp; [ ! -e $forte_install_dir/lib/libmodbus.a ]; then
  echo "---- Build libmodbus from source..."
  cd libmodbus
  ./autogen.sh &amp;&gt;/dev/null
  ./configure --with-pic --enable-static --enable-shared=no --host=${forte_compiler_prefix:0:-1} --prefix=$forte_install_dir &amp;&gt;/dev/null
  make clean &amp;&gt;/dev/null
  make -j4 &amp;&gt;/dev/null
  if [[ $? -eq 0 ]]; then
    echo "---- Build libmodbus succeeded"
  else
    echo "!!!! Build libmodbus failed!"
    exit
  fi
  make install &amp;&gt;/dev/null
  if [[ $? -eq 0 ]]; then
    echo "---- Libraries install completed"
  else
    echo "!!!! Install libmodbus failed!"
    exit
  fi
  make clean &amp;&gt;/dev/null
fi

cd $forte_sources_dir
#build libluajit if shared library not exists
if [ -d "LuaJIT" ] &amp;&amp; ([ ! -e $forte_install_dir/lib/libluajit-5.1.so ] &amp;&amp; [ ! -e $forte_install_dir/lib/lua51.dll ]); then
  echo "---- Build LuaJIT from source..."
  cd LuaJIT
  make clean &amp;&gt;/dev/null
  make -j4 CROSS=$forte_compiler_prefix CFLAGS=-DLUAJIT_ENABLE_LUA52COMPAT $forte_luajit_config  &amp;&gt;/dev/null
  if [[ $? -eq 0 ]]; then
    if [ "$forte_arch" == "x86_w64" ]; then
      #special tricks for windows
      mv src/luajit.exe src/luajit
      cp src/lua51.dll $forte_install_dir/lib/
    fi
    echo "---- Build libluajit succeeded"
  else
    echo "!!!! Build libluajit failed!"
    exit
  fi
  make install CROSS=$forte_compiler_prefix- CFLAGS=-DLUAJIT_ENABLE_LUA52COMPAT PREFIX=$forte_install_dir  &amp;&gt;/dev/null
  if [[ $? -eq 0 ]]; then
    if [ "$forte_arch" == "x86_w64" ]; then
      mv $forte_install_dir/bin/luajit $forte_install_dir/bin/luajit.exe
    fi
    echo "---- Libraries install completed"
  else
    echo "!!!! Install libluajit failed!"
    exit
  fi
  make clean &amp;&gt;/dev/null
fi

cd $forte_sources_dir
CMAKE_ARGS=$(cat &lt;&lt;-END
  -DCMAKE_C_COMPILER:FILEPATH=${forte_compiler_prefix}gcc \
  -DCMAKE_CXX_COMPILER:FILEPATH=${forte_compiler_prefix}g++ \
  -DCMAKE_BUILD_TYPE=MinSizeRel \
  -DCMAKE_INSTALL_PREFIX=$forte_install_dir \
  -DENABLE_PROGRAMS=OFF \
  -DENABLE_TESTING=OFF \
  -DCMAKE_C_COMPILER_WORKS=ON \
  $forte_cmake_extra
END
)
if [ -d "mbedtls" ] &amp;&amp; [ ! -e $forte_install_dir/lib/libmbedcrypto.a ]; then
  echo "---- Build libmbedcrypto, libmbedtls, libmbedx509 from source..."
  mkdir -p $forte_build_dir/mbedtls
  cd $forte_build_dir/mbedtls
  #I have to run cmake twice to make it fully applied
  cmake -G "Unix Makefiles" "-DCMAKE_C_STANDARD_LIBRARIES=$forte_cmake_libs" $CMAKE_ARGS $forte_sources_dir/mbedtls &amp;&gt;/dev/null
  cmake -G "Unix Makefiles" "-DCMAKE_C_STANDARD_LIBRARIES=$forte_cmake_libs" $CMAKE_ARGS $forte_sources_dir/mbedtls &amp;&gt;/dev/null
  make -j4 &amp;&gt;/dev/null
  if [[ $? -eq 0 ]]; then
    echo "---- Build libmbedcrypto, libmbedtls, libmbedx509 succeeded"
  else
    echo "!!!! Build libmbedcrypto, libmbedtls, libmbedx509 failed!"
    exit
  fi
  make install &amp;&gt;/dev/null
  if [[ $? -eq 0 ]]; then
    echo "---- Libraries install completed"
  else
    echo "!!!! Install libmbedcrypto, libmbedtls, libmbedx509 failed!"
    exit
  fi
  make clean &amp;&gt;/dev/null
  unset CMAKE_ARGS
fi

cd $forte_sources_dir
CMAKE_ARGS=$(cat &lt;&lt;-END
  -DCMAKE_C_COMPILER=${forte_compiler_prefix}gcc \
  -DCMAKE_CXX_COMPILER=${forte_compiler_prefix}g++ \
  -DCMAKE_BUILD_TYPE=MinSizeRel \
  -DCMAKE_INSTALL_PREFIX=$forte_install_dir \
  -DPAHO_BUILD_SHARED=OFF \
  -DPAHO_BUILD_STATIC=ON \
  -DPAHO_ENABLE_TESTING=OFF \
  -DPAHO_HIGH_PERFORMANCE=TRUE \
  -DPAHO_WITH_SSL=OFF \
  -DOPENSSL_INCLUDE_DIR=$forte_install_dir/include \
  -DOPENSSL_ROOT_DIR=$forte_install_dir \
  -DCMAKE_C_COMPILER_WORKS=ON \
  $forte_cmake_extra
END
)
if [ -d "paho.mqtt.c" ] &amp;&amp; [ ! -e $forte_install_dir/lib/libpaho-mqtt3a.a ]; then
  echo "---- Build libpaho-mqtt from source..."
  mkdir -p $forte_build_dir/paho.mqtt.c
  cd $forte_build_dir/paho.mqtt.c
  #I have to run cmake twice to make it fully applied
  cmake -G "Unix Makefiles" $CMAKE_ARGS $forte_sources_dir/paho.mqtt.c &amp;&gt;/dev/null
  cmake -G "Unix Makefiles" $CMAKE_ARGS $forte_sources_dir/paho.mqtt.c &amp;&gt;/dev/null
  make -j4 &amp;&gt;/dev/null
  if [[ $? -eq 0 ]]; then
    echo "---- Build libpaho-mqtt succeeded"
  else
    echo "!!!! Build libpaho-mqtt failed!"
    exit
  fi
  make install &amp;&gt;/dev/null
  if [[ $? -eq 0 ]]; then
    echo "---- Libraries install completed"
  else
    echo "!!!! Install libpaho-mqtt failed!"
    exit
  fi
  make clean &amp;&gt;/dev/null
  unset CMAKE_ARGS
fi

cd $forte_sources_dir
CMAKE_ARGS=$(cat &lt;&lt;-END
  -DCMAKE_C_COMPILER=${forte_compiler_prefix}gcc \
  -DCMAKE_CXX_COMPILER=${forte_compiler_prefix}g++ \
  -DCMAKE_BUILD_TYPE=MinSizeRel \
  -DCMAKE_INSTALL_PREFIX=$forte_install_dir \
  -DUA_ARCHITECTURE=$forte_cmake_ua_arch \
  -DUA_ENABLE_AMALGAMATION=ON \
  -DUA_ENABLE_DISCOVERY=ON \
  -DUA_ENABLE_DISCOVERY_MULTICAST=ON \
  -DUA_ENABLE_ENCRYPTION=MBEDTLS \
  -DMBEDTLS_INCLUDE_DIR=$forte_install_dir/include \
  -DMBEDCRYPTO_LIBRARY=$forte_install_dir/lib/libmbedcrypto.a \
  -DMBEDTLS_LIBRARY=$forte_install_dir/lib/libmbedtls.a \
  -DMBEDX509_LIBRARY=$forte_install_dir/lib/libmbedx509.a \
  -DCMAKE_C_COMPILER_WORKS=ON \
  $forte_cmake_extra
END
)
if [ -d "open62541" ] &amp;&amp; [ ! -e $forte_install_dir/lib/libopen62541.a ]; then
  echo "---- Build libopen62541 from source..."
  mkdir -p $forte_build_dir/open62541
  cd $forte_build_dir/open62541
  #I have to run cmake twice to make it fully applied
  cmake -G "Unix Makefiles" $CMAKE_ARGS "-DCMAKE_C_FLAGS_MINSIZEREL:STRING=-Wno-error -Os -DNDEBUG" $forte_sources_dir/open62541 &amp;&gt;/dev/null
  cmake -G "Unix Makefiles" $CMAKE_ARGS "-DCMAKE_C_FLAGS_MINSIZEREL:STRING=-Wno-error -Os -DNDEBUG" $forte_sources_dir/open62541 &amp;&gt;/dev/null
  make -j4 &amp;&gt;/dev/null
  if [[ $? -eq 0 ]]; then
    echo "---- Build libopen62541 succeeded"
  else
    echo "!!!! Build libopen62541 failed!"
    exit
  fi
  make install &amp;&gt;/dev/null
  if [[ $? -eq 0 ]]; then
    echo "---- Libraries installed in $forte_install_dir"
  else
    echo "!!!! Install libopen62541 failed!"
    exit
  fi
  make clean &amp;&gt;/dev/null
  unset CMAKE_ARGS
fi
echo "==== Dependencies build completed"

echo "==== Build 4diac's FORTE from sources..."
cd $forte_sources_dir
CMAKE_ARGS=$(cat &lt;&lt;-END
  -DCMAKE_C_COMPILER=${forte_compiler_prefix}gcc \
  -DCMAKE_CXX_COMPILER=${forte_compiler_prefix}g++ \
  -DCMAKE_BUILD_TYPE=MinSizeRel \
  -DCMAKE_INSTALL_PREFIX=$forte_install_dir \
  -DFORTE_ARCHITECTURE=$forte_cmake_arch \
  -DFORTE_COM_HTTP=ON \
  -DFORTE_COM_SER=ON \
  -DFORTE_COM_MODBUS=ON \
  -DFORTE_COM_MODBUS_LIB_DIR=$forte_install_dir \
  -DFORTE_COM_OPC_UA=ON \
  -DFORTE_COM_OPC_UA_ENCRYPTION=ON \
  -DFORTE_COM_OPC_UA_INCLUDE_DIR=$forte_install_dir/include \
  -DFORTE_COM_OPC_UA_LIB=libopen62541.a \
  -DFORTE_COM_OPC_UA_LIB_DIR=$forte_install_dir/lib \
  -DFORTE_COM_OPC_UA_MULTICAST=ON \
  -DFORTE_COM_PAHOMQTT=ON \
  -DFORTE_COM_PAHOMQTT_INCLUDE_DIR=$forte_install_dir/include \
  -DFORTE_COM_PAHOMQTT_LIB=libpaho-mqtt3a.a \
  -DFORTE_COM_PAHOMQTT_LIB_DIR=$forte_install_dir/lib \
  -DFORTE_EXTERNAL_MODULES_DIRECTORY=$forte_root_dir/ext_modules \
  -DFORTE_MODULE_CONVERT=ON \
  -DFORTE_MODULE_IEC61131=ON \
  -DFORTE_MODULE_RECONFIGURATION=ON \
  -DFORTE_MODULE_RT_Events=ON \
  -DFORTE_MODULE_UTILS=ON \
  -DFORTE_MODULE_KUMAJAYA=ON \
  -DFORTE_USE_LUATYPES=LuaJIT \
  -DLUAJIT_INCLUDE_DIR=$forte_install_dir/include/luajit-2.1 \
  -DLUAJIT_LIBRARY=$forte_install_dir/lib/$forte_cmake_luajit_lib \
  -DFORTE_COM_OPC_UA_ENCRYPTION_MBEDTLS=ON \
  -DFORTE_COM_OPC_UA_ENCRYPTION_INCLUDE_DIR=$forte_install_dir/include \
  -DFORTE_COM_OPC_UA_ENCRYPTION_LIB_DIR=$forte_install_dir/lib \
  -DFORTE_IPLayerRecvBufferSize=25000 \
  -DFORTE_TESTS=OFF \
  $forte_cmake_extra
END
)
#let forte build multiple time
if [ -d "org.eclipse.4diac.forte" ]; then
  echo "---- Build FORTE from source..."
  mkdir -p $forte_build_dir/org.eclipse.4diac.forte
  cd $forte_build_dir/org.eclipse.4diac.forte
  #I have to run cmake twice to make it fully applied
  cmake -G "Unix Makefiles" $CMAKE_ARGS "-DCMAKE_CXX_STANDARD_LIBRARIES:STRING=$forte_cmake_libs" $forte_sources_dir/org.eclipse.4diac.forte &amp;&gt;/dev/null
  cmake -G "Unix Makefiles" $CMAKE_ARGS "-DCMAKE_CXX_STANDARD_LIBRARIES:STRING=$forte_cmake_libs" $forte_sources_dir/org.eclipse.4diac.forte
  make -j4
  if [[ $? -eq 0 ]]; then
    if [ "$forte_arch" == "x86_w64" ]; then
      #special tricks for windows
      [ -f "src/CMakeFiles/CMakeRelink.dir/forte.exe" ] &amp;&amp; mv src/CMakeFiles/CMakeRelink.dir/forte.exe src/CMakeFiles/CMakeRelink.dir/forte
    fi
    echo "---- Build forte succeeded"
  else
    echo "!!!! Build forte failed!"
    exit
  fi
  make install
  if [[ $? -eq 0 ]]; then
    ${forte_compiler_prefix}strip $forte_install_dir/bin/forte
    if [ "$forte_arch" == "x86_w64" ]; then
      mv $forte_install_dir/bin/forte $forte_install_dir/bin/forte.exe
      #copy the only library needed by forte
      cp $forte_install_dir/lib/lua51.dll $forte_install_dir/bin/
      [ -f "src/CMakeFiles/CMakeRelink.dir/forte" ] &amp;&amp; mv src/CMakeFiles/CMakeRelink.dir/forte src/CMakeFiles/CMakeRelink.dir/forte.exe
    fi
    echo "---- Binary installed in $forte_install_dir"
  else
    echo "!!!! Install forte failed!"
    echo "!!!! Try run the script once again."
    exit
  fi
fi
echo "==== Build 4diac's FORTE completed"
echo "==== Build 4diac's FORTE for $forte_arch end"
</code></pre>

  </div>

  <a class="u-url" href="/kiiota-blog/forte/2024/01/20/4diacs-forte-cross-build-on-wsl.html" hidden></a>
  <meta itemprop="mainEntityOfPage" content="https://kumajaya.github.io/kiiota-blog/forte/2024/01/20/4diacs-forte-cross-build-on-wsl.html">
</article>

<style>
.post-category {
  text-transform: uppercase;
  font-size: 0.875rem;
  margin-bottom: 0.25rem;
}

.post-feature-image {
  margin-top: 1rem;
}

.post-feature-img {
  width: 100%;
  height: auto;
  border-radius: 6px;
}

.post-feature-caption {
  font-size: 0.875rem;
  color: #6b7280;
  margin-top: 0.25rem;
}
</style>

      </div>
    </main><link id="fa-stylesheet" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.0/css/all.min.css">

<footer class="site-footer h-card">
  <data class="u-url" value="/kiiota-blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <ul class="contact-list">
          <li class="p-name">Ketut Kumajaya</li>
          <li><a class="u-email" href="mailto:ketut.kumajaya@gmail.com">ketut.kumajaya@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Kiiota Blog adalah ruang catatan teknis dan refleksi humanis di dunia otomasi industri. Berisi dokumentasi eksperimen, troubleshooting, dan filosofi kerja yang lahir dari lapangan. Repositori ini menyimpan konten dalam bentuk statis, memungkinkan backup otomatis, serta publikasi via static site generator (Jekyll, Hugo, Eleventy) dan GitHub Pages.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
    <a rel="me" href="https://github.com/kumajaya/kiiota-blog" target="_blank" title="Repositori Kiiota Blog di GitHub">
      <span class="grey fa-brands fa-github fa-lg"></span>
    </a>
  </li><li>
    <a rel="me" href="https://x.com/ketutkumajaya" target="_blank" title="Ketut Kumajaya at X (formerly Twitter)">
      <span class="grey fa-brands fa-x-twitter fa-lg"></span>
    </a>
  </li>
  <li>
    <a href="https://kumajaya.github.io/kiiota-blog/feed.xml" target="_blank" title="Subscribe to syndication feed">
      <svg class="svg-icon grey" viewbox="0 0 16 16">
        <path d="M12.8 16C12.8 8.978 7.022 3.2 0 3.2V0c8.777 0 16 7.223 16 16h-3.2zM2.194
          11.61c1.21 0 2.195.985 2.195 2.196 0 1.21-.99 2.194-2.2 2.194C.98 16 0 15.017 0
          13.806c0-1.21.983-2.195 2.194-2.195zM10.606
          16h-3.11c0-4.113-3.383-7.497-7.496-7.497v-3.11c5.818 0 10.606 4.79 10.606 10.607z"
        />
      </svg>
    </a>
  </li>
</ul>
</div>

  </div>

</footer>
<!-- PrismJS: Core syntax highlighting engine and plugins -->
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/prism.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/autoloader/prism-autoloader.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/toolbar/prism-toolbar.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/command-line/prism-command-line.min.js"></script>

<script defer>
  window.addEventListener('DOMContentLoaded', () => {
    // Configure Prism Autoloader
    if (Prism.plugins.autoloader) {
      Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/';
    }

    // Add line numbers to all code blocks
    document.querySelectorAll('pre[class*=language-]').forEach(node => {
      node.classList.add('line-numbers');
    });

    // Trigger syntax highlighting
    Prism.highlightAll();
  });
</script>

<!-- KaTeX: Load math typesetting engine + auto-render -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>

<script defer>
  document.addEventListener("DOMContentLoaded", () => {
    renderMathInElement(document.body, {
      delimiters: [
        {left: "$$", right: "$$", display: true},   // Block
        {left: "$", right: "$", display: false},     // Inline
        {left: "\\(", right: "\\)", display: false},
        {left: "\\[", right: "\\]", display: true}
      ]
    });
  });
</script>

<!-- Mermaid.js: Initialize diagrams -->
<script defer src="https://cdn.jsdelivr.net/npm/mermaid@11.9.0/dist/mermaid.min.js" crossorigin="anonymous"></script>
<script defer>
  window.addEventListener('DOMContentLoaded', () => {
    if (!window.mermaid) return;

    mermaid.initialize({
      startOnLoad: false,        // Manual rendering
      theme: 'base',
      fontFamily: 'Segoe UI, sans-serif',
      securityLevel: 'loose',
      themeVariables: {
        primaryColor: '#f0f7ff',
        primaryBorderColor: '#3b82f6'
      }
    });

    // Lazy-load observer for Mermaid diagrams
    const observer = new IntersectionObserver((entries, obs) => {
      entries.forEach(async entry => {
        if (entry.isIntersecting) {
          const el = entry.target;
          if (!el.id) el.id = `mermaid-diagram-${Math.random().toString(36).substr(2, 9)}`;
          await mermaid.run({ querySelector: `#${el.id}` });
          el.classList.add('is-ready');
          obs.unobserve(el);
        }
      });
    }, { rootMargin: '100px' });

    document.querySelectorAll('.mermaid').forEach(el => observer.observe(el));
  });
</script>

<!-- Audio Card Enhancement: Replace Ghost audio cards with native players -->
<script defer>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".kg-audio-card").forEach(function (card) {
      const audio = card.querySelector("audio");
      const title = card.querySelector(".kg-audio-title")?.textContent || "";
      const src = audio?.getAttribute("src");

      if (!src) return;

      // Buat elemen player
      const nativePlayer = document.createElement("audio");
      nativePlayer.setAttribute("controls", "");
      nativePlayer.setAttribute("preload", "metadata");

      const source = document.createElement("source");
      source.setAttribute("src", src);
      source.setAttribute("type", "audio/mpeg");
      nativePlayer.appendChild(source);

      // Tambahkan fallback sebagai node teks
      nativePlayer.appendChild(document.createTextNode(
        "Browser Anda tidak mendukung pemutar audio atau file tidak tersedia."
      ));

      // Bungkus semua dalam wrapper
      const wrapper = document.createElement("div");
      wrapper.className = "native-audio-wrapper";

      // Tambahkan caption di atas player
      if (title) {
        const caption = document.createElement("div");
        caption.className = "audio-title";
        caption.textContent = title;
        wrapper.appendChild(caption);
      }

      wrapper.appendChild(nativePlayer);

      // Tambahkan metadata untuk audit/logging
      wrapper.setAttribute("data-audio-source", src);
      wrapper.setAttribute("data-audio-title", title);

      // Ganti elemen Ghost dengan versi native
      card.replaceWith(wrapper);
    });
  });
</script>
</body>

</html>
